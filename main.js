(()=>{"use strict";function t(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/cards/".concat(t),{method:"DELETE",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}var e=document.querySelector("#card-template").content;function n(t,n,o,r,c){var a=e.querySelector(".card").cloneNode(!0);a.id=t._id;var i=a.querySelector(".card__image"),u=a.querySelector(".card__title");i.src=t.link,i.alt=t.name,u.textContent=t.name;var s=t._id,l=a.querySelector(".card__delete-button");t.owner._id!==c?l.classList.add("card__delete-button-hidden"):l.addEventListener("click",(function(){n(s).then((function(t){a.remove(),console.log(t)})).catch((function(t){console.log(t)}))}));var d=t.likes.find((function(t){return t._id===c})),f=a.querySelector(".card__like-button");d&&f.classList.add("card__like-button_is-active");var p=a.querySelector(".card__like-number");return p.textContent=t.likes.length,f.addEventListener("click",(function(){r(f,p,a.id)})),i.addEventListener("click",o),a}function o(t,e,n){t.classList.contains("card__like-button_is-active")?function(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n).then((function(n){t.classList.remove("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){console.log(t)})):function(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n).then((function(n){t.classList.add("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){console.log(t)}))}function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a),document.addEventListener("click",i)}function c(t){t.classList.remove("popup_is-opened"),document.addEventListener("keydown",a),document.addEventListener("click",i)}function a(t){"Escape"===t.key&&c(document.querySelector(".popup_is-opened"))}function i(t){t.target.classList.contains("popup_is-opened")&&c(document.querySelector(".popup_is-opened"))}function u(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function s(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function l(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){u(t,n,e)})),o.classList.add(e.inactiveButtonClass)}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var f=document.querySelector(".places__list"),p=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),h=document.querySelectorAll(".popup__close"),v=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__image"),S=document.querySelector(".popup__caption"),C=document.querySelector(".popup_type_edit-image"),k=document.forms["edit-profile"],g=k.elements.name,E=k.elements.description,q=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),j=document.querySelector(".profile__image"),x=k.querySelector(".popup__button"),w=document.forms["new-place"],T=w.elements["place-name"],A=w.elements.link,P=w.querySelector(".popup__button"),z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},B=document.querySelector(".profile__image-edit-button"),O=document.forms["update-avatar"],D=O.elements.url,I=O.querySelector(".popup__button");function M(t){b.src=t.target.src,b.alt=t.target.alt,S.textContent=t.target.alt,r(y)}p.addEventListener("click",(function(){g.value=q.textContent,E.value=L.textContent,l(k,z),r(v)})),m.addEventListener("click",(function(){l(w,z),r(_)})),B.addEventListener("click",(function(){l(O,z),r(C)})),k.addEventListener("submit",(function(t){var e,n;t.preventDefault(),x.textContent="Сохранение...",(e=g.value,n=E.value,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/users/me",{method:"PATCH",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){q.textContent=t.name,L.textContent=t.about,c(v)})).catch((function(t){console.log(t)})).finally((function(){x.textContent="Сохранить"}))})),w.addEventListener("submit",(function(e){e.preventDefault(),P.textContent="Сохранение...";var r,a,i={name:T.value,link:A.value};(r=i.name,a=i.link,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/cards",{method:"POST",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"},body:JSON.stringify({name:r,link:a})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){var r=n(e,t,M,o,e.owner._id);f.prepend(r),c(_)})).catch((function(t){console.log(t)})).finally((function(){P.textContent="Сохранить"}))})),h.forEach((function(t){t.addEventListener("click",(function(t){c(t.target.closest(".popup"))}))})),[v,_,y].forEach((function(t){t.classList.add("popup_is-animated")})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);s(n,o,e.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=n,e.classList.add(o.inputErrorClass),r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),s(n,o,e)}))}))}(e,t)}))}(z),Promise.all([fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/users/me",{method:"GET",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/cards",{method:"GET",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))]).then((function(e){var r,c,a=(c=2,function(t){if(Array.isArray(t))return t}(r=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return i}}(r,c)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(r,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];q.textContent=i.name,L.textContent=i.about,j.style.backgroundImage="url('".concat(i.avatar,"')");var s=i._id;u.forEach((function(e){var r=n(e,t,M,o,s);f.append(r)}))})).catch((function(t){console.log(t)})),O.addEventListener("submit",(function(t){var e;t.preventDefault(),I.textContent="Сохранение...",(e=D.value,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-2/users/me/avatar",{method:"PATCH",headers:{authorization:"00a50603-3b89-411f-9cf8-279a0dd3be9f","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){j.style.backgroundImage="url('".concat(t.avatar,"')"),c(C)})).catch((function(t){console.log(t)})).finally((function(){I.textContent="Сохранить"}))}))})();